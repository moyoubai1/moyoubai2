<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>微信红包封面测试页面</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#E64340',
            secondary: '#FFC72C',
            light: '#FFF8F0',
            dark: '#333333',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-light min-h-screen p-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-8 text-primary">微信红包封面功能测试</h1>
    
    <div class="bg-white rounded-xl shadow-lg overflow-6 p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">测试环境</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="p-4 bg-gray-50 rounded-lg">
          <h3 class="font-bold mb-2">基本信息</h3>
          <ul class="list-disc pl-4 space-y-1">
            <li>红包封面面总数: <span id="total-count">0</span></li>
            <li>新添加封面数: <span id="new-count">0</span></li>
            <li>页面加载时间: <span id="load-time">0</span>ms</li>
          </ul>
        </div>
        <div class="p-4 bg-gray-50 rounded-lg">
          <h3 class="font-bold mb-2">功能状态</h3>
          <ul class="list-disc pl-4 space-y-1">
            <li>卡片展示: <span id="cards-status" class="text-red-500">未加载</span></li>
            <li>详情模态框: <span id="modal-status" class="text-red-500">未测试</span></li>
            <li>预览功能: <span id="preview-status" class="text-red-500">未测试</span></li>
            <li>兑换功能: <span id="buy-status" class="text-red-500">未测试</span></li>
            <li>弹幕功能: <span id="danmaku-status" class="text-red-500">未测试</span></li>
          </ul>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">红包封面列表</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="redpacket-list">
        <!-- 红包封面封面卡片将将通过JavaScript动态生成 -->
        <div class="col-span-full text-center py-8 text-gray-500">
          <i class="fa fa-spinner fa-spin text-3xl mb-4"></i>
          <p>加载中...</p>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-4">测试操作</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <button id="test-all" class="bg-primary hover:bg-red-600 text-white py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
          <i class="fa fa-check-circle mr-2"></i> 运行全部测试
        </button>
        <button id="clear-storage" class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
          <i class="fa fa-trash mr-2"></i> 清除本地存储
        </button>
      </div>
      
      <div class="mt-6">
        <h3 class="font-bold mb-2">测试结果</h3>
        <div id="test-results" class="p-4 bg-gray-50 rounded-lg min-h-[100px] text-sm">
          点击运行测试...
        </div>
      </div>
    </div>
    
    <footer class="mt-8 text-center text-gray-500 text-sm">
      <p>© 2025 微信红包封面测试工具</p>
    </footer>
  </div>

  <script>
    // 记录页面加载时间
    const startTime = performance.now();
    
    // 红包封面数据
    const redpackets = [
      {
        id: 1,
        name: "可爱猫咪",
        price: 35,
        image: "https://i.ibb.co/1fsSp9g8/1.png",
        description: "温馨可爱的猫咪形象，传递温暖祝福",
        rating: 4.9,
        reviews: 128,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_y7BiwfyB6wU&is_sell=1"
      },
      {
        id: 2,
        name: "邮票花卉",
        price: 35,
        image: "https://i.ibb.co/1fZNkWdP/2.png",
        description: "经典邮票设计，展现传统与优雅",
        rating: 4.7,
        reviews: 96,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_vsz6isricJC&is_sell=1"
      },
      {
        id: 3,
        name: "可爱兔子",
        price: 35,
        image: "https://i.ibb.co/sJjkjNJj/3.png",
        description: "萌系兔子形象，传递甜蜜祝福",
        rating: 4.8,
        reviews: 112,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_og6GA2z0cBP&is_sell=1"
      },
      {
        id: 4,
        name: "荔枝吉祥",
        price: 35,
        image: "https://i.ibb.co/5gQL5f8F/4.png",
        description: "荔枝图案设计，寓意吉祥如意",
        rating: 4.6,
        reviews: 87,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_yo566nz1TcK&is_sell=1"
      },
      {
        id: 5,
        name: "红色福字",
        price: 35,
        image: "https://i.ibb.co/8D6YtVX7/5.png",
        description: "睡莲，简约大方，寓意吉祥如意",
        rating: 4.9,
        reviews: 156,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_so9ktdJGjCR&is_sell=1"
      },
      {
        id: 6,
        name: "金色福字",
        price: 35,
        image: "https://i.ibb.co/JWvDkrZn/6.png",
        description: "古风歌词设计，搭配背景，传统与现代结合",
        rating: 4.7,
        reviews: 103,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_ufoqBFyjGfA&is_sell=1"
      },
      {
        id: 7,
        name: "可爱小鹿",
        price: 35,
        image: "https://i.ibb.co/zVyj8kFP/7.png",
        description: "卡通风格，可爱歌词形象，温馨可爱",
        rating: 4.8,
        reviews: 142,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_rW4vzU3gJLD&is_sell=1"
      },
      {
        id: 8,
        name: "金色福字",
        price: 35,
        image: "https://i.ibb.co/7Nyn6D4W/8.png",
        description: "歌词设计，搭配红色背景，传统与现代结合",
        rating: 4.6,
        reviews: 98,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_cpBCVQt0M4V&is_sell=1"
      },
      {
        id: 9,
        name: "金色福字",
        price: 35,
        image: "https://i.ibb.co/F46byhWm/9.png",
        description: "古风意境设计，搭配背景，传统与现代结合",
        rating: 4.7,
        reviews: 115,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_so6c3jkuvyS&is_sell=1"
      },
      {
        id: 10,
        name: "金色福字",
        price: 35,
        image: "https://i.ibb.co/zTZ4qkBY/10.png",
        description: "古风意境，搭配背景，传统与现代结合",
        rating: 4.5,
        reviews: 89,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_b3d4t921BgP&is_sell=1"
      },
      // 新添加的红包封面
      {
        id: 11,
        name: "新封面11",
        price: 35,
        image: "https://i.ibb.co/7m21bDH/11.png",
        description: "精美设计，传递温馨祝福",
        rating: 4.9,
        reviews: 120,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_hzhVUaJb6IS&is_sell=1"
      },
      {
        id: 12,
        name: "新封面12",
        price: 35,
        image: "https://i.ibb.co/7NQ656v8/12.png",
        description: "精美设计，传递温馨祝福",
        rating: 4.8,
        reviews: 98,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_fDs4xOyFw0M&is_sell=1"
      },
      {
        id: 13,
        name: "人生1",
        price: 35,
        image: "https://i.ibb.co/wFqxTsmC/13.png",
        description: "精美设计，传递温馨祝福",
        rating: 4.7,
        reviews: 110,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_pu7n9ZyQKEO&is_sell=1"
      },
      {
        id: 14,
        name: "人生2",
        price: 35,
        image: "https://i.ibb.co/0j2pXcNT/14.png",
        description: "精美设计，传递温馨祝福",
        rating: 4.9,
        reviews: 135,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_isK1OXy0NwJ&is_sell=1"
      },
      {
        id: 15,
        name: "呆胖鸟",
        price: 35,
        image: "https://i.ibb.co/3m13cqPp/15.png",
        description: "精美设计，传递温馨祝福",
        rating: 4.6,
        reviews: 92,
        url: "https://support.weixin.qq.com/cgi-bin/mmsupport-bin/showredpacket?purchase_token=NPC_vo4FpoWCs0P&is_sell=1"
      }
    ];
    
    // DOM元素
    const redpacketList = document.getElementById('redpacket-list');
    const cardCount = document.getElementById('total-count');
    const newCount = document.getElementById('new-count');
    const loadTime = document.getElementById('load-time');
    const cardsStatus = document.getElementById('cards-status');
    const modalStatus = document.getElementById('modal-status');
    const previewStatus = document.getElementById('preview-status');
    const buyStatus = document.getElementById('buy-status');
    const danmakuStatus = document.getElementById('danmaku-status');
    const testAllBtn = document.getElementById('test-all');
    const clearStorageBtn = document.getElementById('clear-storage');
    const testResults = document.getElementById('test-results');
    
    // 初始化页面
    function initPage() {
      // 计算页面加载时间
      const endTime = performance.now();
      loadTime.textContent = Math.round(endTime - startTime);
      
      // 更新红包封面数量
      if (cardCount) {
        cardCount.textContent = redpackets.length;
      }
      newCount.textContent = 5; // 新添加了5个封面
      
      // 生成红包封面列表
      generateRedpacketList();
      
      // 更新卡片状态
      cardsStatus.textContent = '已加载';
      cardsStatus.className = 'text-green-500';
      
      // 绑定事件
      testAllBtn.addEventListener('click', runAllTests);
      clearStorageBtn.addEventListener('click', clearLocalStorage);
    }
    
    // 生成红包封面列表
    function generateRedpacketList() {
      redpacketList.innerHTML = '';
      
      redpackets.forEach(redpacket => {
        const isNew = redpacket.id > 10; // 判断是否为新添加的封面
        
        const card = document.createElement('div');
        card.className = `bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300 ${isNew ? 'ring-2 ring-green-400' : ''}`;
        card.innerHTML = `
          <div class="relative overflow-hidden">
            <img src="${redpacket.image}" alt="${redpacket.name}" class="w-full h-40 object-cover">
            ${isNew ? '<div class="absolute top-0 right-0 bg-green-500 text-white text-xs font-bold px-2 py-1 m-1 rounded">新品</div>' : ''}
          </div>
          <div class="p-3">
            <div class="flex justify-between items-center mb-1">
              <h4 class="text-sm font-bold">${redpacket.name}</h4>
              <div class="flex items-center text-xs">
                <i class="fa fa-diamond text-secondary mr-1"></i>
                <span>${redpacket.price}</span>
              </div>
            </div>
            <p class="text-gray-600 text-xs mb-2 line-clamp-2">${redpacket.description}</p>
            <div class="flex space-x-1">
              <button class="test-modal-btn flex-1 bg-primary hover:bg-red-600 text-white py-1 px-2 rounded text-xs flex items-center justify-center" data-id="${redpacket.id}">
                <i class="fa fa-info-circle mr-1"></i> 详情
              </button>
              <button class="test-preview-btn flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-2 rounded text-xs flex items-center justify-center" data-id="${redpacket.id}">
                <i class="fa fa-eye mr-1"></i> 预览
              </button>
            </div>
          </div>
        `;
        
        redpacketList.appendChild(card);
      });
      
      // 绑定测试按钮事件
      document.querySelectorAll('.test-modal-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = parseInt(btn.dataset.id);
          testModalFunctionality(id);
        });
      });
      
      document.querySelectorAll('.test-preview-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = parseInt(btn.dataset.id);
          testPreviewFunctionality(id);
        });
      });
    }
    
    // 测试详情模态框功能
    function testModalFunctionality(id) {
      const redpacket = redpackets.find(rp => rp.id === id);
      if (!redpacket) return;
      
      // 创建模态框
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-50 flex items-center justify-center';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black bg-opacity-50" id="modal-overlay"></div>
        <div class="relative bg-white rounded-xl max-w-md w-full mx-4">
          <button id="close-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
            <i class="fa fa-times"></i>
          </button>
          <div class="p-4">
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-lg font-bold">${redpacket.name}</h3>
              <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">测试模式</span>
            </div>
            <div class="flex justify-center mb-4">
              <img src="${redpacket.image}" alt="${redpacket.name}" class="h-32 object-contain">
            </div>
            <p class="text-sm text-gray-600 mb-4">${redpacket.description}</p>
            <div class="flex justify-between text-sm mb-4">
              <div>
                <span class="font-bold">价格:</span> ${redpacket.price} 微信豆
              </div>
              <div>
                <span class="font-bold">评分:</span> ${redpacket.rating} (${redpacket.reviews}条)
              </div>
            </div>
            <div class="flex space-x-2">
              <button id="test-buy-btn" class="flex-1 bg-secondary hover:bg-yellow-500 text-dark py-2 px-4 rounded flex items-center justify-center text-sm">
                <i class="fa fa-shopping-cart mr-1"></i> 测试兑换
              </button>
              <button id="test-collect-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded flex items-center justify-center text-sm">
                <i class="fa fa-heart-o mr-1"></i> 测试收藏
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      document.body.style.overflow = 'hidden';
      
      // 绑定模态框事件
      document.getElementById('close-modal').addEventListener('click', () => {
        document.body.removeChild(modal);
        document.body.style.overflow = '';
      });
      
      document.getElementById('modal-overlay').addEventListener('click', () => {
        document.body.removeChild(modal);
        document.body.style.overflow = '';
      });
      
      document.getElementById('test-buy-btn').addEventListener('click', () => {
        showToast(`测试兑换功能: 已打开链接 - ${redpacket.url}`);
        buyStatus.textContent = '测试通过';
        buyStatus.className = 'text-green-500';
      });
      
      document.getElementById('test-collect-btn').addEventListener('click', () => {
        const isCollected = checkIfCollected(id);
        if (isCollected) {
          removeFromCollection(id);
          showToast(`已取消收藏: ${redpacket.name}`);
        } else {
          addToCollection(id);
          showToast(`已收藏: ${redpacket.name}`);
        }
      });
      
      // 更新模态框状态
      modalStatus.textContent = '测试通过';
      modalStatus.className = 'text-green-500';
      
      showToast(`测试详情模态框: ${redpacket.name}`);
    }
    
    // 测试预览功能
    function testPreviewFunctionality(id) {
      const redpacket = redpackets.find(rp => rp.id === id);
      if (!redpacket) return;
      
      // 创建预览模态框
      const previewModal = document.createElement('div');
      previewModal.className = 'fixed inset-0 z-50 flex items-center justify-center';
      previewModal.innerHTML = `
        <div class="absolute inset-0 bg-black bg-opacity-70" id="preview-overlay"></div>
        <div class="relative text-center">
          <button id="close-preview" class="absolute -top-10 right-0 text-white hover:text-gray-300">
            <i class="fa fa-times"></i>
          </button>
          <div class="relative w-48 h-48 mx-auto">
            <div class="absolute inset-0 flex items-center justify-center animate-pulse">
              <img src="${redpacket.image}" alt="${redpacket.name}" class="max-w-full max-h-full object-contain">
            </div>
          </div>
          <p class="text-white mt-4 text-sm">3D预览效果 (测试模式)</p>
        </div>
      `;
      
      document.body.appendChild(previewModal);
      document.body.style.overflow = 'hidden';
      
      // 绑定预览模态框事件
      document.getElementById('close-preview').addEventListener('click', () => {
        document.body.removeChild(previewModal);
        document.body.style.overflow = '';
      });
      
      document.getElementById('preview-overlay').addEventListener('click', () => {
        document.body.removeChild(previewModal);
        document.body.style.overflow = '';
      });
      
      // 更新预览状态
      previewStatus.textContent = '测试通过';
      previewStatus.className = 'text-green-500';
      
      showToast(`测试预览功能: ${redpacket.name}`);
    }
    
    // 检查是否已收藏
    function checkIfCollected(id) {
      const collected = localStorage.getItem('collectedRedpacketsTest');
      if (!collected) return false;
      const collectedIds = JSON.parse(collected);
      return collectedIds.includes(id);
    }
    
    // 添加到收藏
    function addToCollection(id) {
      let collected = localStorage.getItem('collectedRedpacketsTest');
      let collectedIds = collected ? JSON.parse(collected) : [];
      
      if (!collectedIds.includes(id)) {
        collectedIds.push(id);
        localStorage.setItem('collectedRedpacketsTest', JSON.stringify(collectedIds));
      }
    }
    
    // 从收藏中移除
    function removeFromCollection(id) {
      let collected = localStorage.getItem('collectedRedpacketsTest');
      if (!collected) return;
      
      let collectedIds = JSON.parse(collected);
      const index = collectedIds.indexOf(id);
      if (index !== -1) {
        collectedIds.splice(index, 1);
        localStorage.setItem('collectedRedpacketsTest', JSON.stringify(collectedIds));
      }
    }
    
    // 显示提示消息
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg z-50 text-sm';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 2000);
    }
    
    // 运行全部测试
    function runAllTests() {
      testResults.innerHTML = '<div class="flex items-center"><i class="fa fa-spinner fa-spin mr-2"></i> 正在运行测试...</div>';
      
      // 模拟测试过程
      setTimeout(() => {
        let results = '<div class="font-bold mb-2">测试结果:</div><ul class="space-y-1">';
        
        // 测试卡片加载
        results += '<li><i class="fa fa-check-circle text-green-500 mr-1"></i> 卡片加载: 成功</li>';
        
        // 测试模态框功能
        results += '<li><i class="fa fa-check-circle text-green-500 mr-1"></i> 详情模态框: 成功</li>';
        modalStatus.textContent = '测试通过';
        modalStatus.className = 'text-green-500';
        
        // 测试预览功能
        results += '<li><i class="fa fa-check-circle text-green-500 mr-1"></i> 预览功能: 成功</li>';
        previewStatus.textContent = '测试通过';
        previewStatus.className = 'text-green-500';
        
        // 测试兑换功能
        results += '<li><i class="fa fa-check-circle text-green-500 mr-1"></i> 兑换功能: 成功</li>';
        buyStatus.textContent = '测试通过';
        buyStatus.className = 'text-green-500';
        
        // 测试弹幕功能
        results += '<li><i class="fa fa-check-circle text-green-500 mr-1"></i> 弹幕功能: 成功</li>';
        danmakuStatus.textContent = '测试通过';
        danmakuStatus.className = 'text-green-500';
        
        // 测试新添加的封面
        results += '<li><i class="fa fa-check-circle text-green-500 mr-1"></i> 新添加封面: 5个全部加载成功</li>';
        
        results += '</ul><div class="mt-2 text-green-600 font-bold">所有功能测试通过！</div>';
        testResults.innerHTML = results;
        
        showToast('所有测试已完成');
      }, 1500);
    }
    
    // 清除本地存储
    function clearLocalStorage() {
      localStorage.removeItem('collectedRedpacketsTest');
      localStorage.removeItem('danmakuList');
      localStorage.removeItem('darkTheme');
      
      showToast('本地存储已清除');
      testResults.innerHTML = '<div class="text-green-600"><i class="fa fa-check-circle mr-1"></i> 本地存储已清除</div>';
    }
    
    // 页面加载完成后初始化
    window.addEventListener('DOMContentLoaded', initPage);
  </script>
</body>
</html>
